<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Weak modular structure · EvoDynamics.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">EvoDynamics.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../api/">API</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example1/">Simplest model</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Weak modular structure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Weak modular structure</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kavir1698/EvoDynamics.jl/blob/master/examples/example2.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Weak-modular-structure-1"><a class="docs-heading-anchor" href="#Weak-modular-structure-1">Weak modular structure</a><a class="docs-heading-anchor-permalink" href="#Weak-modular-structure-1" title="Permalink"></a></h1><pre><code class="language-julia">using Distributions
using Random
using LinearAlgebra

nspecies = 10
P = fill(3, nspecies)
L = fill(3, nspecies)
m = fill(1, nspecies)
A = Tuple([rand(Normal(0, 0.01), i, i) for i in (L .* m)])</code></pre><pre><code class="language-none">([-0.004147278792353456 0.006045667004529118 -0.003774485272652644; 0.000384612079138972 0.00988370766394969 0.014979976824545802; 0.0009495804081866881 -0.005411728427173198 0.002937602794695566], [0.008866154984291033 -0.0030043839091865795 -0.008269994963295358; -0.0018708973636941148 0.005739341824205406 0.009600653190576066; 0.00697427306774999 -0.009878642482611454 0.0023880929359796845], [0.0020809157375297643 -0.0176042882337377 0.01099471530559465; -0.00864516206694668 -0.009714926873621996 0.00427987988328835; 0.018298525921726542 0.0025587892791610767 0.001059463590413662], [0.0005840427290945289 0.014737887829946832 0.007805649125629032; -0.0002744462078307584 0.010224246998277935 0.0009126369127744314; -0.005742482004032469 0.001711194662360036 0.004413627118827775], [0.005770284044870706 -0.012586686127599557 -0.008687643733605858; -0.002308085942685942 0.018431902002707796 0.025899273114806585; -0.002165616228494473 0.0020596618958455045 -0.002257722719284047], [-0.005355281940191013 -0.003756099521218162 -0.0010432015647156834; 0.016580309870115315 0.0074774961711756485 -0.006642605666915422; 0.011592593850627027 -0.008284852136388014 0.007379912680169088], [-0.004026230892190014 0.003699967023099518 -0.007106263963958311; -0.006975885807312278 0.00020863809534389514 -0.001581648500124714; -0.004906072476629462 -0.004694405836027332 -0.0060799576328018036], [-0.0026033149286387143 0.0009472144637265587 0.015355228686655032; -0.0002283914335886787 -0.005081927543007487 0.01393424602061903; 0.011919565186952266 -0.02469369127226581 0.01651606440803145], [0.0014057532671507753 0.013248078886114026 0.0005941880658196777; 0.01025770354796021 0.004189731490788841 -0.026477311852676315; -0.009822443987130855 -0.017016546449674166 0.004098645387509203], [0.00836027380138136 -0.005276902582327046 0.007017556683871618; -0.01757492011792082 -0.010421119877209992 -0.0018566797500908867; 0.015029830571940649 0.007274640426594333 -0.014261325573811406])</code></pre><p>choose random values for epistasis matrix A, but make sure the diagonal is 1.0, meaning that each locus affects itself 100%.</p><pre><code class="language-">for index in 1:length(A)
  for diag in 1:size(A[index], 1)
    A[index][diag, diag] = 1.0
  end
end

mig = rand(10, 10)
mig[LinearAlgebra.diagind(mig)] .= 1.0

parameters = Dict(
  :L =&gt; L .* m,
  :P =&gt; P,
  :R =&gt; fill(0.1, nspecies),
  :C =&gt; rand(Normal(0, 0.001), nspecies, nspecies),
  :B =&gt; Tuple([LinearAlgebra.diagm(fill(true, max(P[i], L[i] * m[i]))) for i in 1:nspecies]),
  :A =&gt;  A,
  :Q =&gt; Tuple([rand() for el in 1:l] for l in L .* m),
  :Y =&gt; fill(0.0, nspecies),
  :m =&gt; m,
  :T =&gt; Tuple([randn(Float16, n) for n in P]),
  :Ω =&gt; Tuple([LinearAlgebra.diagm(fill(1.0, max(i[1], i[2]))) for i in zip(P, P)]),
  :M =&gt; Tuple([(0.02, 0.0, 0.0) for i in 1:nspecies]),
  :D =&gt; Tuple([(0.01, 0.0, 0.01) for i in 1:nspecies]),
  :N =&gt; Dict(i =&gt; fill(100, nspecies) for i in 1:nspecies),
  :K =&gt; Dict(i =&gt; fill(1000, nspecies) for i in 1:nspecies),
  :migration_rates =&gt; [mig for i in 1:nspecies],
  :E =&gt; Tuple(0.001 for i in 1:nspecies),
  :generations =&gt; 5,
  :space =&gt; (5,2),
)

function nspecies_per_species1(model::ABM)

  nspecies = length(model.properties[:P])
  mean_fitness = Array{Float32}(undef, nspecies)
  for species in 1:nspecies
    fitness = mean([i.W for i in values(model.agents) if i.species == species])
    mean_fitness[species] = fitness
  end

  return Tuple(mean_fitness)
end

data = runmodel(parameters, collect::Dict=Dict(:model =&gt; [nspecies_per_species1]))</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 1 April 2020 11:15">Wednesday 1 April 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
